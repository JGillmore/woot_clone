{% extends 'layout.html' %}

{% block title %}Item{% endblock %}

{% block content %}
	<div class="row align center" style="margin-bottom: 70px;">
		{% for m in messages %}
		<h1>{{m}}</h1>
		{% endfor %}
		<h4>{{item.name}}</h4>
		<h5>Units {{items_left}} out of {{item.units}}</h5>

		{% load static %}
		<img src="{{item.image}}" alt="{{item.name}}">
		<h4>Price:${{item.price}}</h4>
		<form method="POST" action="/add_cart/{{item.id}}">
		{% csrf_token %}
			<select name="quantity">
				<option value="1">1</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5</option>
			</select>
			<button class='btn btn-success' type="submit">Add to cart</button>
		</form>
		<h4>Item Rating: {{rating_avg.rating__avg}}</h4>
		<p>{% if not r == 0 %}Update your rating of product{% endif %}</p>
		<form method="POST" action="/add_rating">
		{% csrf_token %}
				<p style="display: inline-block;">
  					<input name="rating" type="radio" id="rating1" value="1" {%if r.rating == 1%} checked="checked" {%endif%}/>
  					<label for="rating1"><span class="glyphicon glyphicon-star"></span></label>
				</p>
				<p style="display: inline-block;">
    				<input name="rating" type="radio" id="rating2" value="2" {%if r.rating == 2%} checked="checked" {%endif%}/>
    				<label for="rating2"><span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star"></span></label>
  			</p>
  			<p style="display: inline-block;">
    				<input name="rating" type="radio" id="rating3"  value="3" {%if r.rating == 3%} checked="checked" {%endif%} />
    				<label for="rating3"><span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star"></span></label>
  			</p>
  			<p style="display: inline-block;">
    				<input name="rating" type="radio" id="rating4" value="4" {%if r.rating == 4%} checked="checked" {%endif%} />
    				<label for="rating4"><span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star"></span></label>
 				</p>
 				<p style="display: inline-block;">
    				<input name="rating" type="radio" id="rating5"  value="5" {%if r.rating == 5%} checked="checked" {%endif%} />
    				<label for="rating5"><span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star"></span></label>
 				</p>
 				<input type="hidden" name="hidden" value="{{item.id}}">
				<button class='btn btn-default' type="submit">Submit rating</button>
			</form>
		<p>{{item.description}}</p>
		  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
		  <script type="text/javascript">
		  	google.charts.load('current', {packages: ['corechart', 'bar']});
				google.charts.setOnLoadCallback(drawRightY);
				function drawRightY() {
					var data = {{chart_data|safe}};
      		var data = google.visualization.arrayToDataTable(data);
		      var options = {
		        chart: {
		          title: 'Items sold per hour',
		        },
		        hAxis: {
		          title: 'Items Sold',
		          minValue: 0,
		        },
		        vAxis: {
                minValue:0,
                viewWindowMode: "explicit",
                title: 'Hour',
                viewWindow: {
                    min: 0
                }
            },
		        bars: 'vertical',
		        axes: {
		          y: {
		            0: {side: 'bottom'}
		          }
		        }
		      };
		      var material = new google.charts.Bar(document.getElementById('chart_div'));
		      material.draw(data, options);
		    }
		  </script>
  <div id="chart_div"></div>
		<form action="/add_discussion" method="POST">
		{% csrf_token %}
			<label for="discussion">Add Discussion</label>
			<textarea name="discussion"></textarea>
			<input type="hidden" name="hidden_id" value="{{item.id}}">
			<button class='btn btn-default' type="submit">Add discussion</button>
		</form>
		{% for d in discussion %}
			<h6>{{d.user.first_name}}</h6>
			<h6 class="thin">{{d.created_at}}</h6>
			<p style="padding-left: 2em;">{{d.discussion}}</p>
		{% endfor %}
	</div>
{% endblock %}
